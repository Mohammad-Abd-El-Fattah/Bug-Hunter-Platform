{% extends "base.html" %}
{% block title %}Bug Bounty Platforms - Bug Hunter Enhanced{% endblock %}
{% block content %}
<div class="row mb-4">
    <div class="col">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="h3 fw-bold"><i class="bi bi-building me-2"></i>Bug Bounty Platforms</h1>
                <p class="text-muted">Manage your bug bounty platforms and programs.</p>
            </div>
            <button class="btn btn-gradient" data-bs-toggle="modal" data-bs-target="#platformModal" onclick="openPlatformModal()">
                <i class="bi bi-plus-lg me-2"></i>Add Platform
            </button>
        </div>
    </div>
</div>
<div class="row g-4" id="platformsGrid">
    {% for platform in platforms %}
    <div class="col-lg-4 col-md-6" data-platform-id="{{ platform.id }}">
        <div class="card h-100">
            <div class="card-body">
                <h5 class="card-title">{{ platform.name }}</h5>
                <p class="text-muted small">{{ platform.description or 'No description provided.' }}</p>
                 <div class="d-flex justify-content-between align-items-center mt-4">
                    <span class="badge {{ 'bg-success' if platform.is_active else 'bg-secondary' }}">
                        {{ 'Active' if platform.is_active else 'Inactive' }}
                    </span>
                    <div class="btn-group">
                        <button class="btn btn-sm btn-outline-light" onclick="openPlatformModal({{ platform.id }})"><i class="bi bi-pencil"></i></button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deletePlatform({{ platform.id }})"><i class="bi bi-trash"></i></button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <div class="col-12 text-center py-5">
        <i class="bi bi-building text-muted" style="font-size: 4rem;"></i>
        <h4 class="text-muted mt-3">No platforms added yet</h4>
    </div>
    {% endfor %}
</div>

<div class="modal fade" id="platformModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTitle">Add Platform</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form id="platformForm">
                <div class="modal-body">
                    <input type="hidden" id="platformId" name="id">
                    <div class="mb-3">
                        <label for="platformName" class="form-label">Platform Name</label>
                        <input type="text" class="form-control" id="platformName" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label for="platformUrl" class="form-label">Platform URL</label>
                        <input type="url" class="form-control" id="platformUrl" name="url">
                    </div>
                    <div class="mb-3">
                        <label for="platformDescription" class="form-label">Description</label>
                        <textarea class="form-control" id="platformDescription" name="description" rows="3"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-gradient">Save Platform</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    let currentPlatformId = null;
    const platformModal = new bootstrap.Modal(document.getElementById('platformModal'));

    function openPlatformModal(platformId = null) {
        const form = document.getElementById('platformForm');
        form.reset();
        currentPlatformId = platformId;

        if (platformId) {
            document.getElementById('modalTitle').textContent = 'Edit Platform';
            API.request(`/api/platforms/${platformId}`).then(response => {
                const platform = response.data;
                document.getElementById('platformId').value = platform.id;
                document.getElementById('platformName').value = platform.name;
                document.getElementById('platformUrl').value = platform.url;
                document.getElementById('platformDescription').value = platform.description;
            });
        } else {
            document.getElementById('modalTitle').textContent = 'Add Platform';
        }
    }
    
    document.getElementById('platformForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const formData = new FormData(this);
        const data = Object.fromEntries(formData.entries());
        const url = currentPlatformId ? `/api/platforms/${currentPlatformId}` : '/api/platforms';
        const method = currentPlatformId ? 'PUT' : 'POST';

        try {
            await API.request(url, { method: method, body: JSON.stringify(data), headers: { 'Content-Type': 'application/json' } });
            platformModal.hide();
            location.reload();
        } catch (error) {
            console.error('Failed to save platform:', error);
        }
    });

    async function deletePlatform(platformId) {
        if (confirm('Are you sure you want to delete this platform?')) {
            try {
                await API.request(`/api/platforms/${platformId}`, { method: 'DELETE' });
                location.reload();
            } catch (error) {
                console.error('Failed to delete platform:', error);
            }
        }
    }
</script>
{% endblock %}
